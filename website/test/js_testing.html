<!DOCTYPE html>
<!-- TODO:

    get api function
    make game code itself

    make guess code
    integrate with website
    design


-->
<html>
    <p> Before Script </p>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    
    <script>

        function get_initial_city(starting_range){
            // TODO set values
            var base_pop = 0
            var multiple = 20000
            var rand_num = 0

            var looking_for_city = true
            while( looking_for_city == true){
                if (starting_range == 'tenk'){
                    base_pop = 10000
                    multiple = 20000
                    // TODO: have to update random number
                    rand_num = 1
                }
                else if (starting_range == 'hundredk'){
                    base_pop = 100000
                    multiple = 20000
                    rand_num = 1
                }
                else if (starting_range == 'onemil'){
                    base_pop = 1000000
                    multiple = 20000
                    rand_num = 1
                }

                var min_pop = base_pop + multiple * rand_num
                var max_pop = min_pop + multiple
                // TODO: change country
                var api_url = 'https://api.api-ninjas.com/v1/city?country=US&min_population=' + min_pop + '&max_population=' + max_pop + '&limit=1';

                

                

                // API call. If fails goes back to start of loop
                // try{
                response_dict = get_api_call(api_url)


                if (response_dict == 'api_call_failed') {
                    continue
                }

                // If successful breaks loop
                looking_for_city = false


                return response_dict
            }
        }

        


        function get_api_call(api_url){

            // have to make and update global variable
            var response_dict
            function updateResult(data) {
                response_dict = data[0];
            }

            // gets dictionary object if api successful
            try{
                $.ajax({
                    method: 'GET',
                    url: api_url,
                    headers: { 'X-Api-Key': '1/IM/Lmf6TebQhklcoTpiQ==sHCkkzz1m4vHjTJR'},
                    contentType: 'application/json',
                    async: !1,
                    success: function(result) {
                        // if successful updates here
                        updateResult(result)
                        console.log(result);
                    },
                    error: function ajaxError(jqXHR) {
                        console.error('Error: ', jqXHR.responseText);
                    }
                });
            }
            catch{
                // failed
                return "api_call_failed"
            }

            return response_dict
        }


        function get_lat_lon(api_dict, type){
            if (type == 'lat'){
                return api_dict['latitude']
            }
            else if (type == 'lon'){
                return api_dict['longitude']
            }
        }

        function calcDist(lat1, lon1, lat2, lon2, unit) {
            if ((lat1 == lat2) && (lon1 == lon2)) {
                return 0;
            }
            else {
                var radlat1 = Math.PI * lat1/180;
                var radlat2 = Math.PI * lat2/180;
                var theta = lon1-lon2;
                var radtheta = Math.PI * theta/180;
                var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                if (dist > 1) {
                    dist = 1;
                }
                dist = Math.acos(dist);
                dist = dist * 180/Math.PI;
                dist = dist * 60 * 1.1515;
                if (unit=="K") { dist = dist * 1.609344 }
                if (unit=="N") { dist = dist * 0.8684 }
                return Math.round(dist);
            }
        }

        function guess_button_onclick(){
            act_dict = game.return_answer.call(game)
            guess_dict = validate_guess()

            if (guess_dict == 'api_call_failed' || response_dict == undefined) {
                alert('Try again. Check Spelling')
            }
            
            act_lat = get_lat_lon(act_dict, "lat")
            act_lon = get_lat_lon(act_dict, "lon")
            guess_lat = get_lat_lon(guess_dict, "lat")
            guess_lon = get_lat_lon(guess_dict, "lon")
            
            distance = calcDist(act_lat, act_lon, guess_lat, guess_lon, 'M')
            document.write('Finished ', distance)
        }

        function validate_guess(){
            var city_guess = document.getElementById("city_guess").value;
            var api_url = "https://api.api-ninjas.com/v1/city?country=US&name=" + city_guess

            return get_api_call(api_url)
        }

        function game_class(act_dict) {
            this._act_dict = act_dict;
            this.get_answer = function(){
                alert("Answer was: " + this._act_dict['name'])
                return this._act_dict
            }
            this.return_answer = function(){
                return this._act_dict
            }
        }
        
        // function MyClass() {
        //     this.instanceData = "Display Me";

        //     this.DisplayData = function() {
        //         alert(this.instanceData);
        //     }
        // }

        // classInstance = new MyClass();â€‹
        

        act_dict = get_initial_city("hundredk")

        // game = new game_class(get_initial_city("hundredk"));

        game = new game_class(act_dict)

        // saves lat/lon
        // act_lat = get_lat_lon(act_dict, "lat")
        // act_lon = get_lat_lon(act_dict, "lon")

        
        // function get_answer(){
            
        //     document.write(game.act_dict)
        // }



        // document.write(calcDist(40.730610, -73.935242, 34.05223, -118.24368, 'M'))
    
        


    </script>
    <p> After Script </p>

    <input id="answer" type="button" value="Give Up?" onclick="return game.get_answer.call(game)">
    <table>
        <form>
        <tr>
        <td>
            <input id="city_guess" type="text" style="width: 447px" />   
        </td>
        <td>
            <input id="Guess_button" type="submit" value="Guess" onclick="return guess_button_onclick()" /></td>
        </tr>
        </form>
    </table>

</html>
